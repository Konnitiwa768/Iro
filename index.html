<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>画像の色面積計算</title>
  <style>
    body { font-family: sans-serif; padding: 1em; }
    canvas { display: none; }
    #results div { margin: 4px 0; }
  </style>
</head>
<body>
  <h2>画像の色面積計算ツール</h2>
  <input type="file" id="imageUploader" accept="image/*"><br><br>
  <canvas id="canvas"></canvas>
  <div id="results"></div>

  <script>
    const uploader = document.getElementById('imageUploader');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const results = document.getElementById('results');

    uploader.addEventListener('change', () => {
      const file = uploader.files[0];
      if (!file) return;

      const img = new Image();
      img.onload = () => {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        const colorMap = {};
        for (let i = 0; i < data.length; i += 4) {
          const r = data[i];
          const g = data[i + 1];
          const b = data[i + 2];
          const a = data[i + 3];
          if (a < 128) continue; // 半透明は無視

          const key = `${r},${g},${b}`;
          colorMap[key] = (colorMap[key] || 0) + 1;
        }

        const sorted = Object.entries(colorMap)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 200); // 上位200色まで表示

        results.innerHTML = '';
        sorted.forEach(([color, count]) => {
          const [r, g, b] = color.split(',').map(Number);
          const percent = ((count / (canvas.width * canvas.height)) * 100).toFixed(2);
          const colorBox = `<span style="display:inline-block;width:20px;height:20px;background:rgb(${color});margin-right:8px;border:1px solid #aaa;"></span>`;
          results.innerHTML += `<div>${colorBox} ${color} - ${count}ピクセル (${percent}%)</div>`;
        });
      };

      img.src = URL.createObjectURL(file);
    });
  </script>
</body>
</html>
